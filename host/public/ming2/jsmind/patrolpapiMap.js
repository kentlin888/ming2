let mind = {
    "meta": {
        "name": "jsMind",
        "author": "hizzgdev@163.com",
        "version": "0.4.6"
    },
    "format": "node_array",
    "data": [
        {
            "id": "4ktsnina",
            "topic": "Patrolpapi - WPF GUI 12,000行",
            "level": 0,
            "isroot": true
        },
        {
            "id": "zbzga15n",
            "topic": "CakeDB 37,000行",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "oaji8ht7",
            "topic": "Entity Framework",
            "level": 2,
            "parentid": "zbzga15n"
        },
        {
            "id": "w92tiqvr",
            "topic": "LINQ",
            "level": 2,
            "parentid": "zbzga15n"
        },
        {
            "id": "94a0nsjq",
            "topic": "MySQL",
            "level": 2,
            "parentid": "zbzga15n"
        },
        {
            "id": "f9uwati8",
            "topic": "SQLite",
            "level": 2,
            "parentid": "zbzga15n"
        },
        {
            "id": "mmcno581",
            "topic": "CakeTech2 9,000行",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "e9fvudk8",
            "topic": "CakeDB補充套件",
            "level": 2,
            "parentid": "mmcno581"
        },
        {
            "id": "cdfwtv1i",
            "topic": "CakeTools 13,000行",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "j2j5nxt3",
            "topic": "device drivers",
            "level": 2,
            "parentid": "cdfwtv1i"
        },
        {
            "id": "4sew0ekh",
            "topic": "iOS Driver",
            "level": 3,
            "parentid": "j2j5nxt3"
        },
        {
            "id": "vtu2ct6c",
            "topic": "Android Driver",
            "level": 3,
            "parentid": "j2j5nxt3"
        },
        {
            "id": "lnns4ewa",
            "topic": "Web Driver",
            "level": 3,
            "parentid": "j2j5nxt3"
        },
        {
            "id": "vtb11pj1",
            "topic": "OpenCV",
            "level": 2,
            "parentid": "cdfwtv1i"
        },
        {
            "id": "n7e7ajdp",
            "topic": "iOS APP",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "19tmubep",
            "topic": "安裝在iOS上的Agent App (by Swift)",
            "level": 2,
            "parentid": "n7e7ajdp"
        },
        {
            "id": "376kwttn",
            "topic": "Android APP",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "ej3pq8s6",
            "topic": "安裝在Android上的Agent App (by Java)",
            "level": 2,
            "parentid": "376kwttn"
        },
        {
            "id": "rle0enni",
            "topic": "Mac APP",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "skb6zqth",
            "topic": ".Net Core mac端Socket server",
            "level": 2,
            "parentid": "rle0enni"
        },
        {
            "id": "cj605f93",
            "topic": "vm_connector_ppp",
            "level": 2,
            "parentid": "rle0enni"
        },
        {
            "id": "qqe4e26q",
            "topic": "MakeProvision",
            "level": 1,
            "parentid": "4ktsnina"
        },
        {
            "id": "80r01pp5",
            "topic": "對ios .ipa簽章",
            "level": 2,
            "parentid": "qqe4e26q"
        },
        {
            "id": "loecr4x7",
            "topic": "PPP_ViewModal 12,000行",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "3qkquxcw",
            "topic": "MVVM實作",
            "level": 2,
            "parentid": "loecr4x7"
        },
        {
            "id": "i4uxi3x8",
            "topic": "MVVMLight",
            "level": 2,
            "parentid": "loecr4x7"
        },
        {
            "id": "gq3mairi",
            "topic": "PatrolpapiCLI",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "oo3ctjzj",
            "topic": "CLI指令，直接操作patrolpapi",
            "level": 2,
            "parentid": "gq3mairi"
        },
        {
            "id": "xjcw9uj8",
            "topic": "vm_tools 6000行",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "93ux8pwn",
            "topic": ".Net Core跨平台tools",
            "level": 2,
            "parentid": "xjcw9uj8"
        },
        {
            "id": "v6xdi5y6",
            "topic": "vm_tools2 2000行",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "40ac0ckl",
            "topic": ".Net Core跨平台tools",
            "level": 2,
            "parentid": "v6xdi5y6"
        },
        {
            "id": "rcawdw1l",
            "topic": "WebApp_PatrolPapi",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "oecpsy25",
            "topic": "官方網站",
            "level": 2,
            "parentid": "rcawdw1l"
        },
        {
            "id": "7i9xjgpk",
            "topic": "Asp.Net",
            "level": 2,
            "parentid": "rcawdw1l"
        },
        {
            "id": "gq8aolnr",
            "topic": "IIS Host",
            "level": 2,
            "parentid": "rcawdw1l"
        },
        {
            "id": "mzainha9",
            "topic": "wpfFixDBDocument2",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "f4vklzn0",
            "topic": "產生EF Entities",
            "level": 2,
            "parentid": "mzainha9"
        },
        {
            "id": "3vymjulf",
            "topic": "Installer_ppp",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "kow70dr2",
            "topic": "安裝程式打包專案",
            "level": 2,
            "parentid": "3vymjulf"
        },
        {
            "id": "inwe57dv",
            "topic": "UpdatePatrolpapi_Win",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "v3lmpl4w",
            "topic": "window更新程式",
            "level": 2,
            "parentid": "inwe57dv"
        },
        {
            "id": "cn9ivg1h",
            "topic": "Release_PatrolPP 3100行",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "nkxrqt0h",
            "topic": "打包並佈署patrolpapi到Server上",
            "level": 2,
            "parentid": "cn9ivg1h"
        },
        {
            "id": "9lw8r137",
            "topic": "CakeDashBoard",
            "level": 1,
            "parentid": "4ktsnina",
            "direction":"left",
        },
        {
            "id": "f9jedzok",
            "topic": "客戶issue追蹤",
            "level": 2,
            "parentid": "9lw8r137"
        },
        
    ]
};
let arrayColorNodes = []

function colorMind(list_MindData) {
    //let list_ColorData = list_MindData;
    arrayColorNodes = list_MindData.filter((item) => {
        return (item["background-color"]) //not null
    })
    list_MindData.forEach(itemChild => {
        if (itemChild["background-color"])
            return
        if (itemChild.notuse) {
            switch (itemChild.notuse) {
                case 1:// learened
                    itemChild["background-color"] = "#888888" //888888
                    break;
                case 2:// can't do it
                    itemChild["background-color"] = "#888888" //CCCCCC
                    break;
                default:
                    itemChild["background-color"] = "#CCCCCC"
                    break;
            }
            return
        }
        let foundParent = arrayColorNodes.find((itemParent) => {
            return (itemParent.id === itemChild.parentid)
        })
        // possible undefined
        if (foundParent) {
            itemChild["background-color"] = foundParent["background-color"]
            itemChild["foreground-color"] = foundParent["foreground-color"]
        }


        //console.log("LOG: ~ file: 1_basic.js ~ line 445 ~ found ~ found", found)
        // if(arrayColorNodes.includes(item.parentid))//is child
        // item["background-color"] = 
    });
    return list_MindData;
}

function load_jsmind() {
    let list_ColorData = colorMind(mind.data);
    list_ColorData = colorMind(mind.data);
    list_ColorData = colorMind(mind.data);
    list_ColorData = list_ColorData.map((item) => {
        if(item.notuse)
            item.expanded = false;
        return item
    })
    mind.data = list_ColorData;
    var options = {
        container: 'jsmind_container',
        editable: true,
        theme: 'primary',
        view:{
            engine: 'canvas',   // 思维导图各节点之间线条的绘制引擎 canvas/svg
            // hmargin:100,        // 思维导图距容器外框的最小水平距离
            // vmargin:50,         // 思维导图距容器外框的最小垂直距离
            // line_width:2,       // 思维导图线条的粗细
            // line_color:'#555'   // 思维导图线条的颜色
        },
    }
    var jm = jsMind.show(options, mind);
    

    // remove not use nodes
    let listNotuseNodes = list_ColorData.filter((item) => {
        return (item.notuse)
    })
    listNotuseNodes.forEach((item) => {
        jm.remove_node(item.id)
    })
    //jm.remove_node('6c6d020d748cd3f7')//Security

    // jm.set_readonly(true);
    // var mind_data = jm.get_data();
    // alert(mind_data);
    // jm.add_node("sub2", "sub23", "new node", {
    //     "background-color": "red"
    // });
    // jm.set_node_color('sub21', 'green', '#ccc');
}

load_jsmind();
// console.log(arrayColorNodes)